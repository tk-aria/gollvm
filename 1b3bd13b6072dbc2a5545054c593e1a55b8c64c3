{
  "comments": [
    {
      "key": {
        "uuid": "ef99336a_75fcfb19",
        "filename": "bridge/go-llvm-materialize.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1446,
      "author": {
        "id": 13315
      },
      "writtenOn": "2020-05-18T15:32:49Z",
      "side": 1,
      "message": "Could we check the target triple instead?",
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b402deb1_b4cced5d",
        "filename": "bridge/go-llvm-materialize.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1446,
      "author": {
        "id": 24534
      },
      "writtenOn": "2020-05-22T02:48:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ef99336a_75fcfb19",
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6454b425_a9aed9ef",
        "filename": "driver/CompileGo.cpp",
        "patchSetId": 2
      },
      "lineNbr": 953,
      "author": {
        "id": 13315
      },
      "writtenOn": "2020-05-18T15:32:49Z",
      "side": 1,
      "message": "I think it is better to test x86_64 instead.",
      "range": {
        "startLine": 952,
        "startChar": 0,
        "endLine": 953,
        "endChar": 47
      },
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc3d22d9_bed270da",
        "filename": "driver/CompileGo.cpp",
        "patchSetId": 2
      },
      "lineNbr": 953,
      "author": {
        "id": 24534
      },
      "writtenOn": "2020-05-22T02:48:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6454b425_a9aed9ef",
      "range": {
        "startLine": 952,
        "startChar": 0,
        "endLine": 953,
        "endChar": 47
      },
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dcb403cf_ebb05b8c",
        "filename": "unittests/BackendCore/BackendCallTests.cpp",
        "patchSetId": 2
      },
      "lineNbr": 286,
      "author": {
        "id": 13315
      },
      "writtenOn": "2020-05-18T15:32:49Z",
      "side": 1,
      "message": "In my experience, \u003cbadref\u003e typically indicates some sort of problem. I wonder if there is the case here.",
      "range": {
        "startLine": 286,
        "startChar": 4,
        "endLine": 286,
        "endChar": 12
      },
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55989ffa_261e27f6",
        "filename": "unittests/BackendCore/BackendCallTests.cpp",
        "patchSetId": 2
      },
      "lineNbr": 286,
      "author": {
        "id": 24534
      },
      "writtenOn": "2020-05-22T02:48:17Z",
      "side": 1,
      "message": "I guess it\u0027s because we assign the return value of type *g to an variable of type *int64, I run this test on amd64, it\u0027s \u003cbadref\u003e as well.\nI checked the actual IR result of getg in runtime, it\u0027s as follow:\n\n%0 \u003d call %145 asm sideeffect \"adrp $0, :gottprel:runtime.g\\0Aldr  $0, [$0, #:gottprel_lo12:runtime.g]\\0Amrs  $1, tpidr_el0\\0Aldr  $0, [$1, $0]\\0A\", \"\u003dr,\u003dr\"() #9, !dbg !32715\n\nOn amd64, it\u0027s:\n %0 \u003d load %.runtime.g.0*, %.runtime.g.0** @runtime.g, align 8, !dbg !2033\n\nSo I think the implementation should be correct. Maybe we should find a better way to improve this unit test. But I have not found a good way at present.",
      "parentUuid": "dcb403cf_ebb05b8c",
      "range": {
        "startLine": 286,
        "startChar": 4,
        "endLine": 286,
        "endChar": 12
      },
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "11f3b57f_ec673d3c",
        "filename": "unittests/BackendCore/BackendCallTests.cpp",
        "patchSetId": 2
      },
      "lineNbr": 286,
      "author": {
        "id": 13315
      },
      "writtenOn": "2020-05-28T16:39:11Z",
      "side": 1,
      "message": "Okay. It could be just the test. It still looks weird to me. I think we should address it at some point, but not necessarily in this CL.",
      "parentUuid": "55989ffa_261e27f6",
      "range": {
        "startLine": 286,
        "startChar": 4,
        "endLine": 286,
        "endChar": 12
      },
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78893705_3a4e57ac",
        "filename": "unittests/BackendCore/BackendCallTests.cpp",
        "patchSetId": 2
      },
      "lineNbr": 286,
      "author": {
        "id": 14020
      },
      "writtenOn": "2020-05-28T16:50:33Z",
      "side": 1,
      "message": "I looked a little at this. \n\nI think the issue is that the value is anonymous -- if you name it the problem goes away. I think the problem is that the IR printer\u0027s slot mapper can\u0027t discover the value since it operates on a function basis. Patch:\n\ndiff --git a/bridge/go-llvm-materialize.cpp b/bridge/go-llvm-materialize.cpp\nindex d8f0546..63fec77 100644\n--- a/bridge/go-llvm-materialize.cpp\n+++ b/bridge/go-llvm-materialize.cpp\n@@ -1405,7 +1405,8 @@ static llvm::Value *makeGetgArm64(Btype *resType,\n         llvm::FunctionType::get(resType-\u003etype(), llvm::ArrayRef\u003cllvm::Type*\u003e{}, false);\n     llvm::Value *callee \u003d llvm::InlineAsm::get(fnType, llvm::StringRef(asmStr),\n                                                llvm::StringRef(constr), true);\n-    return builder-\u003eCreateCall(fnType, callee);\n+    std::string callname(be-\u003enamegen(\"asmcall\"));\n+    return builder-\u003eCreateCall(fnType, callee, {}, callname);\n   } else {\n     // Static link.\n     asmStr +\u003d \"adrp $0, :gottprel:runtime.g\\n\";\n@@ -1422,7 +1423,8 @@ static llvm::Value *makeGetgArm64(Btype *resType,\n         llvm::FunctionType::get(fnResType, llvm::ArrayRef\u003cllvm::Type*\u003e{}, false);\n     llvm::Value *callee \u003d llvm::InlineAsm::get(fnType, llvm::StringRef(asmStr),\n                                                llvm::StringRef(constr), true);\n-    llvm::Instruction *calI \u003d builder-\u003eCreateCall(fnType, callee);\n+    std::string callname(be-\u003enamegen(\"asmcall\"));\n+    llvm::Instruction *calI \u003d builder-\u003eCreateCall(fnType, callee, {}, callname);\n     return builder-\u003eCreateExtractValue(calI, {0});\n   }\n }",
      "parentUuid": "11f3b57f_ec673d3c",
      "range": {
        "startLine": 286,
        "startChar": 4,
        "endLine": 286,
        "endChar": 12
      },
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "35993ea9_ec32ea44",
        "filename": "unittests/BackendCore/BackendCallTests.cpp",
        "patchSetId": 2
      },
      "lineNbr": 286,
      "author": {
        "id": 24534
      },
      "writtenOn": "2020-05-29T03:20:09Z",
      "side": 1,
      "message": "Thanks, this is the point of this issue. I\u0027ll apply it in the next patch set.",
      "parentUuid": "78893705_3a4e57ac",
      "range": {
        "startLine": 286,
        "startChar": 4,
        "endLine": 286,
        "endChar": 12
      },
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "88c8f134_17222972",
        "filename": "unittests/BackendCore/BackendCallTests.cpp",
        "patchSetId": 2
      },
      "lineNbr": 286,
      "author": {
        "id": 24534
      },
      "writtenOn": "2020-05-29T06:55:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "35993ea9_ec32ea44",
      "range": {
        "startLine": 286,
        "startChar": 4,
        "endLine": 286,
        "endChar": 12
      },
      "revId": "1b3bd13b6072dbc2a5545054c593e1a55b8c64c3",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    }
  ]
}